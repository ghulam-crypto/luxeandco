<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUXE & CO. | Premium Lifestyle</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        luxe: {
                            black: '#1a1a1a',
                            gold: '#D4AF37',
                            light: '#f8f9fa',
                            gray: '#8c8c8c'
                        }
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Lato', sans-serif; scroll-behavior: smooth; }
        h1, h2, h3, h4 { font-family: 'Playfair Display', serif; }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }

        .product-card:hover .overlay { opacity: 1; }
        .product-card:hover img { transform: scale(1.05); }
        
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #D4AF37; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .no-scroll { overflow: hidden; }
    </style>
</head>
<body class="bg-gray-50 text-luxe-black">

    <header class="fixed w-full bg-white/90 backdrop-blur-md z-40 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <button class="md:hidden text-2xl"><i class="fas fa-bars"></i></button>

            <div class="text-2xl font-serif font-bold tracking-widest cursor-pointer" onclick="window.scrollTo(0,0)">
                LUXE <span class="text-luxe-gold">&</span> CO.
            </div>

            <nav class="hidden md:flex gap-8 uppercase text-xs font-bold tracking-widest text-gray-500">
                <a href="#home" class="hover:text-luxe-gold transition-colors">Home</a>
                <a href="#shop" class="hover:text-luxe-gold transition-colors">Shop</a>
                <a href="#about" class="hover:text-luxe-gold transition-colors">Our Story</a>
                <a href="#contact" class="hover:text-luxe-gold transition-colors">Contact</a>
                <a href="#admin" id="nav-admin" class="hidden text-red-600 hover:text-red-800 transition-colors">Admin Panel</a>
            </nav>

            <div class="flex items-center gap-6">
                <button id="auth-btn" onclick="toggleAuthModal()" class="hover:text-luxe-gold text-xs uppercase tracking-widest font-bold">
                    Login
                </button>
                
                <button class="relative hover:text-luxe-gold" onclick="toggleCart()">
                    <i class="fas fa-shopping-bag text-xl"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-luxe-black text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
                </button>
            </div>
        </div>
    </header>

    <section id="home" class="relative h-screen flex items-center justify-center bg-luxe-black text-white overflow-hidden">
        <div class="absolute inset-0 opacity-40">
            <img src="https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=2070&auto=format&fit=crop" class="w-full h-full object-cover" alt="Fashion Background">
        </div>
        <div class="relative z-10 text-center px-4 fade-in">
            <h3 class="text-luxe-gold uppercase tracking-[0.3em] text-sm mb-4">New Collection 2026</h3>
            <h1 class="text-5xl md:text-7xl font-bold mb-6 leading-tight">Define Your <br> <span class="italic font-serif">Signature</span> Style</h1>
            <p class="max-w-md mx-auto text-gray-300 mb-8 font-light">Curated perfumes, bespoke tailoring, and handcrafted footwear.</p>
            <a href="#shop" class="inline-block px-10 py-4 bg-white text-luxe-black font-bold uppercase tracking-widest text-xs hover:bg-luxe-gold hover:text-white transition-all duration-300">
                Shop Now
            </a>
        </div>
    </section>

    <section id="shop" class="py-24 max-w-7xl mx-auto px-6">
        <div class="text-center mb-16">
            <h2 class="text-4xl font-serif font-bold mb-4">Curated Essentials</h2>
            <div class="flex justify-center gap-2 mb-8">
                <span class="h-[1px] w-10 bg-luxe-gold mt-3"></span>
                <p class="text-gray-500 italic">Discover our latest arrivals</p>
                <span class="h-[1px] w-10 bg-luxe-gold mt-3"></span>
            </div>

            <div class="flex justify-center gap-4 flex-wrap">
                <button onclick="filterProducts('all')" class="filter-btn active px-6 py-2 border border-luxe-black bg-luxe-black text-white uppercase text-xs tracking-widest transition-all">All</button>
                <button onclick="filterProducts('perfume')" class="filter-btn px-6 py-2 border border-gray-300 text-gray-500 hover:border-luxe-black hover:text-luxe-black uppercase text-xs tracking-widest transition-all">Perfumes</button>
                <button onclick="filterProducts('clothes')" class="filter-btn px-6 py-2 border border-gray-300 text-gray-500 hover:border-luxe-black hover:text-luxe-black uppercase text-xs tracking-widest transition-all">Clothes</button>
                <button onclick="filterProducts('shoes')" class="filter-btn px-6 py-2 border border-gray-300 text-gray-500 hover:border-luxe-black hover:text-luxe-black uppercase text-xs tracking-widest transition-all">Shoes</button>
            </div>
        </div>

        <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
            <div class="col-span-full text-center text-gray-400 py-12">Loading products... <div class="loader"></div></div>
        </div>
    </section>

    <section id="admin" class="hidden bg-gray-100 py-24 border-t-4 border-luxe-gold">
        <div class="max-w-7xl mx-auto px-6">
            <h2 class="text-3xl font-serif font-bold mb-8">Admin Dashboard</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="bg-white p-6 shadow-sm border-l-4 border-luxe-black">
                    <h4 class="text-gray-500 uppercase text-xs tracking-widest">Total Revenue</h4>
                    <p class="text-3xl font-bold mt-2" id="admin-revenue">Rs 0</p>
                </div>
                <div class="bg-white p-6 shadow-sm border-l-4 border-luxe-gold">
                    <h4 class="text-gray-500 uppercase text-xs tracking-widest">Total Orders</h4>
                    <p class="text-3xl font-bold mt-2" id="admin-orders">0</p>
                </div>
                <div class="bg-white p-6 shadow-sm border-l-4 border-gray-400">
                    <h4 class="text-gray-500 uppercase text-xs tracking-widest">Products Listed</h4>
                    <p class="text-3xl font-bold mt-2" id="admin-products-count">0</p>
                </div>
            </div>

            <div class="bg-white p-8 shadow-sm mb-12">
                <h3 class="text-xl font-bold mb-6">Add New Product</h3>
                <form id="add-product-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <input type="text" id="p-name" placeholder="Product Name" class="border p-3 w-full" required>
                    <select id="p-category" class="border p-3 w-full">
                        <option value="perfume">Perfume</option>
                        <option value="clothes">Clothes</option>
                        <option value="shoes">Shoes</option>
                    </select>
                    <input type="number" id="p-price" placeholder="Price (in Rupees)" class="border p-3 w-full" required>
                    <input type="text" id="p-image" placeholder="Image URL" class="border p-3 w-full" required>
                    <textarea id="p-desc" placeholder="Description" class="border p-3 w-full col-span-full"></textarea>
                    <input type="text" id="p-sizes" placeholder="Sizes (e.g. S, M, L)" class="border p-3 w-full col-span-full">
                    <button type="button" onclick="adminAddProduct()" class="bg-luxe-black text-white py-3 uppercase font-bold tracking-widest col-span-full hover:bg-luxe-gold">Upload Item</button>
                </form>
            </div>

            <h3 class="text-xl font-bold mb-6">Manage Inventory</h3>
            <div id="admin-product-list" class="space-y-4">
            </div>
        </div>
    </section>

    <section id="about" class="bg-luxe-black text-white py-24">
        <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
            <div class="relative">
                <div class="absolute -top-4 -left-4 w-24 h-24 border-t-2 border-l-2 border-luxe-gold"></div>
                <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=2070&auto=format&fit=crop" alt="Store Interior" class="w-full grayscale hover:grayscale-0 transition-all duration-700">
                <div class="absolute -bottom-4 -right-4 w-24 h-24 border-b-2 border-r-2 border-luxe-gold"></div>
            </div>
            <div>
                <h2 class="text-4xl font-serif font-bold mb-6">The Art of Elegance</h2>
                <div id="about-content">
                    <p class="text-gray-400 leading-relaxed mb-6 font-light">Loading our story...</p>
                </div>
                <div id="faq-section" class="mt-8 border-t border-gray-800 pt-8">
                    <h3 class="text-luxe-gold font-serif text-xl mb-4">F.A.Q</h3>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="py-24 max-w-3xl mx-auto px-6 text-center">
        <h2 class="text-3xl font-serif font-bold mb-2">Get in Touch</h2>
        <p class="text-gray-500 mb-10">Questions about sizing? Custom orders? We're here.</p>
        
        <form id="contact-form" class="space-y-6 text-left">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Name</label>
                    <input type="text" name="name" class="w-full bg-gray-50 border border-gray-200 p-4 focus:outline-none focus:border-luxe-gold transition-colors" required>
                </div>
                <div>
                    <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Email</label>
                    <input type="email" name="email" class="w-full bg-gray-50 border border-gray-200 p-4 focus:outline-none focus:border-luxe-gold transition-colors" required>
                </div>
            </div>
            <div>
                <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Subject</label>
                <input type="text" name="subject" class="w-full bg-gray-50 border border-gray-200 p-4 focus:outline-none focus:border-luxe-gold transition-colors">
            </div>
            <div>
                <label class="block text-xs uppercase tracking-widest text-gray-500 mb-2">Message</label>
                <textarea name="message" rows="4" class="w-full bg-gray-50 border border-gray-200 p-4 focus:outline-none focus:border-luxe-gold transition-colors" required></textarea>
            </div>
            <div class="text-center">
                <button type="button" onclick="submitContact()" class="px-12 py-4 bg-luxe-black text-white font-bold uppercase tracking-widest text-xs hover:bg-luxe-gold transition-colors">
                    Send Message
                </button>
            </div>
        </form>
    </section>

    <footer class="bg-gray-100 py-12 border-t border-gray-200">
        <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-4 gap-8 text-sm">
            <div>
                <div class="text-xl font-serif font-bold mb-6">LUXE & CO.</div>
                <p class="text-gray-500">Premium goods for the discerning individual.</p>
            </div>
            <div>
                <h4 class="font-bold uppercase tracking-widest mb-4">Support</h4>
                <ul class="space-y-2 text-gray-500">
                    <li><a href="#" onclick="alert(siteContent.sizeGuide)">Size Guide</a></li>
                    <li><a href="#about">FAQ</a></li>
                </ul>
            </div>
            <div class="col-span-2 text-right">
                <p class="text-gray-400 text-xs mt-12">&copy; 2026 LUXE & CO. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <div id="cart-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity" onclick="toggleCart()"></div>
        <div class="absolute right-0 top-0 h-full w-full md:w-[450px] bg-white shadow-2xl flex flex-col transform transition-transform duration-300 translate-x-full" id="cart-panel">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                <h2 class="text-2xl font-serif font-bold">Your Bag</h2>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-black"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-6"></div>
            <div class="p-6 bg-gray-50 border-t border-gray-100">
                <div class="flex justify-between mb-4 text-sm font-bold">
                    <span>Subtotal</span>
                    <span id="cart-total">Rs 0.00</span>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="toggleCart()" class="py-4 border border-black text-black font-bold uppercase text-xs hover:bg-gray-100">
                        Continue Shopping
                    </button>
                    <button onclick="openCheckout()" class="py-4 bg-luxe-black text-white font-bold uppercase text-xs hover:bg-luxe-gold">
                        Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="fixed inset-0 z-[60] bg-white hidden overflow-y-auto">
        <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 min-h-screen">
            
            <div class="p-8 md:p-12 lg:pr-24 border-r border-gray-200">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-2xl font-serif font-bold cursor-pointer" onclick="closeCheckout()">LUXE & CO.</h1>
                    <button onclick="closeCheckout()" class="text-sm underline text-gray-500">Return to Cart</button>
                </div>

                <div class="space-y-8">
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-lg">Contact</h3>
                            <span class="text-sm text-blue-600 cursor-pointer" onclick="toggleAuthModal()">Sign in</span>
                        </div>
                        <input type="email" id="c-email" placeholder="Email" class="w-full p-3 border border-gray-300 rounded mb-2">
                        <label class="flex items-center gap-2 text-sm text-gray-600">
                            <input type="checkbox" checked class="accent-luxe-black"> Email me with news and offers
                        </label>
                    </div>

                    <div>
                        <h3 class="font-bold text-lg mb-4">Delivery</h3>
                        <div class="grid grid-cols-1 gap-3">
                            <select class="w-full p-3 border border-gray-300 rounded bg-gray-50 text-gray-500">
                                <option>Pakistan</option>
                            </select>
                            <div class="grid grid-cols-2 gap-3">
                                <input type="text" id="c-fname" placeholder="First name" class="w-full p-3 border border-gray-300 rounded">
                                <input type="text" id="c-lname" placeholder="Last name" class="w-full p-3 border border-gray-300 rounded">
                            </div>
                            <input type="text" id="c-address" placeholder="Address" class="w-full p-3 border border-gray-300 rounded">
                            <div class="grid grid-cols-2 gap-3">
                                <input type="text" id="c-city" placeholder="City" class="w-full p-3 border border-gray-300 rounded">
                                <input type="text" id="c-zip" placeholder="Postal code (Optional)" class="w-full p-3 border border-gray-300 rounded">
                            </div>
                            <input type="text" id="c-phone" placeholder="Phone" class="w-full p-3 border border-gray-300 rounded">
                            
                            <label class="flex items-center gap-2 text-sm text-gray-600 mt-2">
                                <input type="checkbox" checked class="accent-luxe-black"> Save this information for next time
                            </label>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-bold text-lg mb-4">Shipping method</h3>
                        <div class="p-4 border border-gray-300 rounded flex justify-between items-center bg-gray-50">
                            <span class="text-sm">Standard Shipping</span>
                            <span class="font-bold text-sm">Rs 250.00</span>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-bold text-lg mb-2">Payment</h3>
                        <p class="text-sm text-gray-500 mb-4">All transactions are secure and encrypted.</p>
                        
                        <div class="border border-gray-300 rounded overflow-hidden">
                            <div class="border-b border-gray-300">
                                <div class="p-4 flex items-center gap-3 bg-gray-50">
                                    <input type="radio" name="payment" id="pay-bank" value="Bank/Wallet" class="accent-luxe-black" onclick="togglePaymentInfo('bank')">
                                    <label for="pay-bank" class="text-sm font-bold flex-1 cursor-pointer">Bank Account / JazzCash / EasyPaisa</label>
                                    <div class="flex gap-1 text-gray-400">
                                        <i class="fas fa-university"></i>
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                </div>
                                <div id="bank-info" class="hidden p-4 bg-gray-50 border-t border-gray-200 text-sm text-gray-600">
                                    <p>Please transfer the total amount to:</p>
                                    <p class="font-bold mt-2">JazzCash: 0300-1234567 (Ghulam Mehdi)</p>
                                    <p class="font-bold">Bank Al-Habib: 1234-5678-9012-3456</p>
                                    <p class="mt-2 text-xs italic">Your order will not ship until we receive payment.</p>
                                </div>
                            </div>
                            
                            <div>
                                <div class="p-4 flex items-center gap-3">
                                    <input type="radio" name="payment" id="pay-cod" value="COD" class="accent-luxe-black" checked onclick="togglePaymentInfo('cod')">
                                    <label for="pay-cod" class="text-sm font-bold flex-1 cursor-pointer">Cash on Delivery (COD)</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-bold text-lg mb-4">Billing address</h3>
                        <div class="border border-gray-300 rounded overflow-hidden">
                            <div class="p-4 border-b border-gray-300 flex items-center gap-3">
                                <input type="radio" name="billing" id="bill-same" checked class="accent-luxe-black">
                                <label for="bill-same" class="text-sm">Same as shipping address</label>
                            </div>
                            <div class="p-4 flex items-center gap-3">
                                <input type="radio" name="billing" id="bill-diff" class="accent-luxe-black">
                                <label for="bill-diff" class="text-sm">Use a different billing address</label>
                            </div>
                        </div>
                    </div>

                    <button onclick="submitOrder()" id="btn-submit" class="w-full py-5 bg-luxe-black text-white font-bold uppercase tracking-widest text-lg">
                        Submit Order
                    </button>
                </div>
            </div>

            <div class="bg-gray-50 p-8 md:p-12 border-l border-gray-200 hidden md:block">
                <div id="checkout-summary" class="sticky top-12 space-y-6">
                </div>
                <div class="sticky top-64 border-t border-gray-200 pt-6 space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Subtotal</span>
                        <span class="font-bold" id="checkout-subtotal">Rs 0.00</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Shipping</span>
                        <span class="font-bold">Rs 250.00</span>
                    </div>
                    <div class="flex justify-between text-xl font-bold mt-4 pt-4 border-t border-gray-200">
                        <span>Total</span>
                        <span id="checkout-total">Rs 0.00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="auth-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleAuthModal()"></div>
        <div class="bg-white p-8 w-full max-w-md z-10 shadow-2xl relative">
            <button onclick="toggleAuthModal()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button>
            
            <div id="login-form-box">
                <h2 class="text-2xl font-serif font-bold mb-6 text-center">Welcome Back</h2>
                <input type="email" id="login-email" placeholder="Email" class="w-full p-3 border mb-3">
                <input type="password" id="login-pass" placeholder="Password" class="w-full p-3 border mb-6">
                <button onclick="handleLogin()" class="w-full bg-luxe-black text-white py-3 uppercase font-bold tracking-widest hover:bg-luxe-gold">Login</button>
                <p class="text-center mt-4 text-sm text-gray-500 cursor-pointer" onclick="switchAuth('signup')">New here? Create Account</p>
            </div>

            <div id="signup-form-box" class="hidden">
                <h2 class="text-2xl font-serif font-bold mb-6 text-center">Create Account</h2>
                <input type="text" id="reg-name" placeholder="Full Name" class="w-full p-3 border mb-3">
                <input type="email" id="reg-email" placeholder="Email" class="w-full p-3 border mb-3">
                <input type="text" id="reg-phone" placeholder="Phone" class="w-full p-3 border mb-3">
                <input type="password" id="reg-pass" placeholder="Password" class="w-full p-3 border mb-6">
                <button onclick="handleSignup()" class="w-full bg-luxe-black text-white py-3 uppercase font-bold tracking-widest hover:bg-luxe-gold">Sign Up</button>
                <p class="text-center mt-4 text-sm text-gray-500 cursor-pointer" onclick="switchAuth('login')">Already have an account? Login</p>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-luxe-black text-white px-6 py-3 rounded shadow-lg z-50 transition-all duration-300 translate-y-20 opacity-0 flex items-center gap-3">
        <i class="fas fa-check-circle text-luxe-gold"></i>
        <span id="toast-msg">Action successful</span>
    </div>

    <script>
        // --- API CONFIGURATION ---
        const API_URL = "https://script.google.com/macros/s/AKfycbwUDRpz8_uF1aG6P7_hYoCaMrUZ9AQOxGHaAhdDu_A1_ysn_Vq8-jhMttAh5ErjPUj8/exec";

        // --- GLOBAL VARIABLES ---
        let allProducts = [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let siteContent = {};

        // --- HELPER FOR API REQUESTS (REPLACES google.script.run) ---
        async function apiRequest(action, payload = {}) {
            // We append the action to the payload so the backend knows what to do
            const bodyData = { action: action, ...payload };
            
            try {
                const response = await fetch(API_URL, {
                    method: "POST", // POST is safer for sending data to GAS
                    body: JSON.stringify(bodyData)
                });
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("API Error:", error);
                alert("Connection error. Please try again.");
                return null;
            }
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            // Fetch Products
            apiRequest('getProducts').then(data => {
                if (data) {
                    allProducts = data;
                    renderProducts(allProducts);
                    loadAdminPanelIfAuth();
                }
            });

            // Fetch Content
            apiRequest('getSiteContent').then(content => {
                if (content) {
                    siteContent = content;
                    document.getElementById('about-content').innerHTML = `<p class="text-gray-400 leading-relaxed font-light">${content.about}</p>`;
                    const faqHTML = content.faq.map(f => `<div class="mb-2"><strong class="text-sm block">${f.q}</strong><span class="text-gray-500 text-sm font-light">${f.a}</span></div>`).join('');
                    document.getElementById('faq-section').innerHTML += faqHTML;
                }
            });

            updateCartUI();
            checkUserStatus();
        };

        // --- PRODUCTS UI ---
        function renderProducts(items) {
            const grid = document.getElementById('product-grid');
            if(items.length === 0) { grid.innerHTML = '<div class="col-span-full text-center py-10">No products found.</div>'; return; }
            grid.innerHTML = items.map(p => `
                <div class="product-card group cursor-pointer">
                    <div class="relative overflow-hidden mb-4 bg-gray-100 aspect-[3/4]">
                        <img src="${p.image}" alt="${p.name}" class="w-full h-full object-cover transition-transform duration-700">
                        <div class="overlay absolute inset-0 bg-black/10 opacity-0 transition-opacity duration-300 flex items-end justify-center pb-6">
                            <button onclick="addToCart('${p.id}')" class="bg-white text-black px-6 py-3 font-bold uppercase text-xs tracking-widest hover:bg-luxe-black hover:text-white transition-colors shadow-lg translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                                Add to Bag
                            </button>
                        </div>
                    </div>
                    <div class="text-center">
                        <h3 class="font-serif text-lg mb-1 group-hover:text-luxe-gold transition-colors">${p.name}</h3>
                        <p class="text-gray-500 font-light">Rs ${p.price}</p>
                    </div>
                </div>
            `).join('');
        }

        function filterProducts(category) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-luxe-black', 'text-white', 'border-luxe-black');
                btn.classList.add('text-gray-500', 'border-gray-300');
            });
            event.target.classList.remove('text-gray-500', 'border-gray-300');
            event.target.classList.add('bg-luxe-black', 'text-white', 'border-luxe-black');
            if (category === 'all') renderProducts(allProducts);
            else renderProducts(allProducts.filter(p => p.category === category));
        }

        // --- CART LOGIC ---
        function addToCart(id) {
            const product = allProducts.find(p => String(p.id) === String(id));
            if(!product) return;
            const existing = cart.find(item => String(item.id) === String(id));
            if (existing) existing.quantity++;
            else cart.push({ ...product, quantity: 1 });
            saveCart();
            updateCartUI();
            
            // Auto open cart
            const modal = document.getElementById('cart-modal');
            if(modal.classList.contains('hidden')) toggleCart();
        }

        function updateQuantity(id, change) {
            const item = cart.find(i => String(i.id) === String(id));
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) cart = cart.filter(i => String(i.id) !== String(id));
                saveCart();
                updateCartUI();
            }
        }

        function saveCart() { localStorage.setItem('cart', JSON.stringify(cart)); }

        function updateCartUI() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const badge = document.getElementById('cart-count');
            badge.innerText = count;
            badge.classList.remove('hidden');
            badge.classList.remove('pop');
            void badge.offsetWidth; badge.classList.add('pop');

            const container = document.getElementById('cart-items');
            if (cart.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 mt-20">Your bag is empty.</div>';
                badge.classList.add('hidden');
            } else {
                container.innerHTML = cart.map(item => `
                    <div class="flex gap-4">
                        <img src="${item.image}" class="w-20 h-24 object-cover bg-gray-100">
                        <div class="flex-1 flex flex-col justify-between py-1">
                            <div>
                                <h4 class="font-serif font-bold">${item.name}</h4>
                                <p class="text-gray-500 text-sm">Rs ${item.price}</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="flex items-center border border-gray-200">
                                    <button onclick="updateQuantity('${item.id}', -1)" class="px-2 py-1">-</button>
                                    <span class="text-xs w-6 text-center">${item.quantity}</span>
                                    <button onclick="updateQuantity('${item.id}', 1)" class="px-2 py-1">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cart-total').innerText = 'Rs ' + total.toFixed(2);
        }

        // --- CHECKOUT LOGIC ---
        function openCheckout() {
            if(cart.length === 0) return alert("Your bag is empty");
            toggleCart(); // Close drawer
            document.getElementById('checkout-modal').classList.remove('hidden');
            document.body.classList.add('no-scroll');
            renderCheckoutSummary();
            
            // Pre-fill if logged in
            if(currentUser) {
                document.getElementById('c-email').value = currentUser.email;
                document.getElementById('c-fname').value = currentUser.name;
                document.getElementById('c-phone').value = currentUser.phone || '';
            }
        }

        function closeCheckout() {
            document.getElementById('checkout-modal').classList.add('hidden');
            document.body.classList.remove('no-scroll');
        }

        function renderCheckoutSummary() {
            const container = document.getElementById('checkout-summary');
            container.innerHTML = cart.map(item => `
                <div class="flex gap-4 items-center">
                    <div class="relative">
                        <img src="${item.image}" class="w-16 h-16 object-cover rounded border border-gray-200">
                        <span class="absolute -top-2 -right-2 bg-gray-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">${item.quantity}</span>
                    </div>
                    <div class="flex-1">
                        <p class="font-bold text-sm">${item.name}</p>
                        <p class="text-xs text-gray-500">${item.category}</p>
                    </div>
                    <p class="font-bold text-sm">Rs ${(item.price * item.quantity).toFixed(2)}</p>
                </div>
            `).join('');

            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('checkout-subtotal').innerText = 'Rs ' + subtotal.toFixed(2);
            document.getElementById('checkout-total').innerText = 'Rs ' + (subtotal + 250).toFixed(2);
        }

        function togglePaymentInfo(type) {
            document.getElementById('bank-info').classList.toggle('hidden', type !== 'bank');
        }

        function submitOrder() {
            const btn = document.getElementById('btn-submit');
            
            // Validation
            const email = document.getElementById('c-email').value;
            const fname = document.getElementById('c-fname').value;
            const address = document.getElementById('c-address').value;
            const phone = document.getElementById('c-phone').value;

            if(!email || !fname || !address || !phone) {
                alert("Please fill in all required fields (Email, Name, Address, Phone).");
                return;
            }

            // Prepare Data
            const paymentMethod = document.getElementById('pay-bank').checked ? "Bank/Wallet" : "COD";
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const total = (subtotal + 250).toFixed(2); // With Shipping

            const orderData = {
                email: email,
                items: cart,
                total: total,
                shipping: {
                    firstName: fname,
                    lastName: document.getElementById('c-lname').value,
                    address: address,
                    city: document.getElementById('c-city').value,
                    zip: document.getElementById('c-zip').value,
                    phone: phone,
                    paymentMethod: paymentMethod
                }
            };

            // Loading State
            btn.innerText = "Processing...";
            btn.disabled = true;

            // Updated to use fetch API
            apiRequest('processOrder', orderData).then(res => {
                if(res && res.success) {
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    document.body.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-screen bg-gray-50 text-center px-4">
                            <div class="text-6xl text-luxe-gold mb-4"><i class="fas fa-check-circle"></i></div>
                            <h1 class="text-3xl font-serif font-bold mb-2">Order Placed!</h1>
                            <p class="text-gray-600 mb-6">Thank you ${fname}. An email confirmation has been sent to ${email}.</p>
                            <p class="font-bold mb-8">Order ID: ${res.orderId}</p>
                            <button onclick="window.location.reload()" class="bg-luxe-black text-white px-8 py-3 uppercase font-bold">Continue Shopping</button>
                        </div>
                    `;
                } else {
                    alert("Error: " + (res ? res.message : "Unknown error"));
                    btn.innerText = "Submit Order";
                    btn.disabled = false;
                }
            });
        }

        // --- AUTH LOGIC ---
        function checkUserStatus() {
            if (currentUser) {
                document.getElementById('auth-btn').innerText = currentUser.name;
                loadAdminPanelIfAuth();
            }
        }

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            
            apiRequest('loginUser', { email: email, pass: pass }).then(res => {
                if(res && res.success) {
                    currentUser = res;
                    localStorage.setItem('currentUser', JSON.stringify(res));
                    checkUserStatus();
                    toggleAuthModal();
                    showToast("Welcome back, " + res.name);
                } else {
                    alert(res ? res.message : "Login failed");
                }
            });
        }

        function handleSignup() {
            const data = {
                name: document.getElementById('reg-name').value,
                email: document.getElementById('reg-email').value,
                phone: document.getElementById('reg-phone').value,
                password: document.getElementById('reg-pass').value
            };
            
            apiRequest('registerUser', data).then(res => {
                if(res && res.success) {
                    alert(res.message);
                    switchAuth('login');
                } else {
                    alert(res ? res.message : "Signup failed");
                }
            });
        }

        function loadAdminPanelIfAuth() {
            if (currentUser && currentUser.role === 'admin') {
                document.getElementById('nav-admin').classList.remove('hidden');
                document.getElementById('admin').classList.remove('hidden');
                // Load Stats
                apiRequest('getAdminStats').then(stats => {
                    if (stats) {
                        document.getElementById('admin-revenue').innerText = 'Rs ' + stats.totalRevenue;
                        document.getElementById('admin-orders').innerText = stats.totalOrders;
                        document.getElementById('admin-products-count').innerText = stats.totalProducts;
                    }
                });
                // Load Admin Product List
                renderAdminList();
            }
        }

        function renderAdminList() {
            const list = document.getElementById('admin-product-list');
            list.innerHTML = allProducts.map(p => `
                <div class="flex justify-between items-center bg-white p-4 shadow-sm border border-gray-100">
                    <div class="flex gap-4 items-center">
                        <img src="${p.image}" class="w-12 h-12 object-cover">
                        <div><p class="font-bold">${p.name}</p><p class="text-xs text-gray-500">Rs ${p.price}</p></div>
                    </div>
                    <button onclick="adminDelete('${p.id}')" class="text-red-500 text-sm hover:underline">Remove</button>
                </div>
            `).join('');
        }

        // --- ADMIN FUNCTIONS ---
        function adminAddProduct() {
            if(!currentUser) { alert("Session expired. Please login again."); return; }
            
            const product = {
                name: document.getElementById('p-name').value,
                category: document.getElementById('p-category').value,
                price: document.getElementById('p-price').value,
                image: document.getElementById('p-image').value,
                description: document.getElementById('p-desc').value,
                size_guide: document.getElementById('p-sizes').value
            };
            
            apiRequest('adminAddProduct', { product: product, email: currentUser.email }).then(res => {
                if(res && res.success) { alert("Product Added!"); window.location.reload(); }
                else { alert(res ? res.message : "Error adding product"); }
            });
        }

        function adminDelete(id) {
            if(!currentUser) { alert("Session expired."); return; }
            
            if(confirm("Are you sure you want to delete this item?")) {
                apiRequest('adminDeleteProduct', { id: id, email: currentUser.email }).then(res => {
                    if(res && res.success) window.location.reload();
                    else alert(res ? res.message : "Error deleting product");
                });
            }
        }

        // --- UI UTILS ---
        function submitContact() {
            const form = document.getElementById('contact-form');
            const data = { name: form.name.value, email: form.email.value, subject: form.subject.value, message: form.message.value };
            apiRequest('submitContactForm', data).then(msg => {
                alert(msg || "Message sent!");
                form.reset();
            });
        }

        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            const panel = document.getElementById('cart-panel');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => panel.classList.remove('translate-x-full'), 10);
            } else {
                panel.classList.add('translate-x-full');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function toggleAuthModal() { document.getElementById('auth-modal').classList.toggle('hidden'); }
        function switchAuth(type) {
            document.getElementById('login-form-box').classList.toggle('hidden', type !== 'login');
            document.getElementById('signup-form-box').classList.toggle('hidden', type !== 'signup');
        }
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => { toast.classList.add('translate-y-20', 'opacity-0'); }, 3000);
        }
    </script>
</body>
</html>
